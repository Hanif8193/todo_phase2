openapi: 3.0.3
info:
  title: Todo App - Authentication API
  description: |
    Authentication endpoints for user signup, signin, and signout.
    Uses Better Auth library for JWT token generation with stateless authentication.
  version: 1.0.0
  contact:
    name: Todo App Team

servers:
  - url: http://localhost:8000
    description: Local development server
  - url: https://api.todo-app.example.com
    description: Production server

paths:
  /auth/signup:
    post:
      summary: Create new user account
      description: |
        Registers a new user with email and password. Automatically signs in the user
        and returns a JWT token valid for 7 days.
      operationId: signup
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignupRequest'
            examples:
              validSignup:
                summary: Valid signup request
                value:
                  email: user@example.com
                  password: securepassword123
      responses:
        '201':
          description: Account created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              examples:
                successfulSignup:
                  summary: Successful signup response
                  value:
                    token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                    user:
                      id: 123
                      email: user@example.com
        '400':
          description: Invalid input or email already registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                emailExists:
                  summary: Email already registered
                  value:
                    detail: Email already registered. Please sign in or use a different email.
                invalidEmail:
                  summary: Invalid email format
                  value:
                    detail: Invalid email format
                passwordTooShort:
                  summary: Password too short
                  value:
                    detail: Password must be at least 8 characters

  /auth/signin:
    post:
      summary: Sign in to existing account
      description: |
        Authenticates user with email and password. Returns JWT token valid for 7 days.
      operationId: signin
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SigninRequest'
            examples:
              validSignin:
                summary: Valid signin request
                value:
                  email: user@example.com
                  password: securepassword123
      responses:
        '200':
          description: Signed in successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              examples:
                successfulSignin:
                  summary: Successful signin response
                  value:
                    token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                    user:
                      id: 123
                      email: user@example.com
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidCredentials:
                  summary: Wrong email or password
                  value:
                    detail: Invalid credentials

  /auth/signout:
    post:
      summary: Sign out current user
      description: |
        Signs out the current user. Since authentication is stateless (JWT),
        this is primarily a client-side operation. The backend endpoint confirms
        the token validity.
      operationId: signout
      tags:
        - Authentication
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Signed out successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
              examples:
                successfulSignout:
                  summary: Successful signout
                  value:
                    message: Signed out successfully
        '401':
          description: Unauthorized (missing or invalid token)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                unauthorizedSignout:
                  summary: Missing authentication token
                  value:
                    detail: Not authenticated

components:
  schemas:
    SignupRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          maxLength: 255
          description: User's email address (used for signin)
          example: user@example.com
        password:
          type: string
          format: password
          minLength: 8
          maxLength: 128
          description: User's password (minimum 8 characters)
          example: securepassword123

    SigninRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User's email address
          example: user@example.com
        password:
          type: string
          format: password
          description: User's password
          example: securepassword123

    AuthResponse:
      type: object
      required:
        - token
        - user
      properties:
        token:
          type: string
          description: JWT authentication token (valid for 7 days)
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxMjMsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSIsImV4cCI6MTcwNjA5NzYwMH0...
        user:
          $ref: '#/components/schemas/UserResponse'

    UserResponse:
      type: object
      required:
        - id
        - email
      properties:
        id:
          type: integer
          description: Unique user identifier
          example: 123
        email:
          type: string
          format: email
          description: User's email address
          example: user@example.com

    MessageResponse:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: Success message
          example: Signed out successfully

    ErrorResponse:
      type: object
      required:
        - detail
      properties:
        detail:
          type: string
          description: Error message describing what went wrong
          example: Invalid credentials

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token obtained from /auth/signup or /auth/signin.
        Include in Authorization header as: Bearer <token>

tags:
  - name: Authentication
    description: User authentication operations (signup, signin, signout)
